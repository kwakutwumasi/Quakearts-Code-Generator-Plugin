<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:b="http://quakearts.com/2.0/boot"
	xmlns:c="http://quakearts.com/2.0/common">
<ui:component>
#foreach($element in $beanModel.beanElements)#if($element.knownInputType && !$element.identity)
	<b:formGroup>
		<label id="${element.value}_label">#if($element.boolean)<h:selectBooleanCheckbox disabled="#{${crudappBeanName}.mode eq 'read'}" value="#{obj.${element.value}}"></h:selectBooleanCheckbox>#end${util.splitCamelCase($element.value)}</label>
#if($element.string || $element.numeric)
		<h:inputText styleClass="form-control" value="#{obj.${element.value}}" disabled="#{${crudappBeanName}.mode eq 'read'#if($element.id) ||(obj.${element.value} != #if($element.primitiveNumber)0#{else}null#end and ${crudappBeanName}.mode eq 'edit')#end}">
#if($element.numeric)
			<f:convertNumber></f:convertNumber>
#end
		</h:inputText>
#elseif(${element.dateTimeType})
		<b:date nullable="true" dayClass="btn-xs" monthClass="btn-xs" yearClass="btn-xs" 
			value="#{obj.${element.value}}" converter="#{${crudappBeanName}.converter}" 
			disabled="#{${crudappBeanName}.mode eq 'read'#if($element.id) ||(obj.${element.value} != #if($element.primitiveNumber)0#{else}null#end and ${crudappBeanName}.mode eq 'edit')#end}">
		</b:date>
#end
	</b:formGroup>
#elseif(${element.nonFk})#elseif(${element.enum})
 	<b:formGroup>
 		<label id="${element.value}_label">${util.splitCamelCase($element.value)}</label>
 		<b:selectOneInput disabled="#{${crudappBeanName}.mode eq 'read'}"
    		value="#{obj.${element.value}}">
    		<f:selectItems value="#{${crudappBeanName}.${util.reverseCamelCase($element.descriptor.propertyType.simpleName)}s}"></f:selectItems>
    	</b:selectOneInput>
	</b:formGroup>
#else#set($elementModel = $classModelMapping[${element.descriptor.propertyType.name}])#if($classModelMapping[${element.descriptor.propertyType.name}])#set($stringValue = "")
#foreach($subelement in $elementModel.beanElements)#if($subelement.string)#set($stringValue ="$stringValue#{${element.value}.${subelement.value}} ")#end#end
#set($insetId=${beanModel.name}+${util.camelCase($elementModel.name)}+"Inset")
#set($dropDownHelper=${crudappBeanName}+"."+${util.reverseCamelCase($elementModel.beanClass.simpleName)}+"DropdownHelper")	<c:unique>
    	<h:panelGroup id="$insetId" layout="block" styleClass="#{loader.overlayClass}">
    		<b:formGroup>
    			<label id="${element.value}_label">${util.splitCamelCase($element.value)}
    				<h:commandLink value="New" styleClass="#{!${dropDownHelper}.inCreateMode?'':'collapse'}"
						rendered="#{facesContext.viewRoot.viewId.endsWith('create.xhtml') or ${crudappBeanName}.mode eq 'edit'}">
    					<f:ajax onevent="#{loader.overlayAjaxLoader}" execute="@this" render="$insetId"></f:ajax>
    					<f:setPropertyActionListener value="#{true}" target="#{${dropDownHelper}.inCreateMode}"></f:setPropertyActionListener>
    				</h:commandLink>
    			</label>
    			<b:selectOneInput mainClass="#{loader.overlayClass}" disabled="#{${crudappBeanName}.mode eq 'read' || ${dropDownHelper}.inCreateMode}"
    				value="#{obj.${element.value}}"#if($stringValue.empty)>#else autocomplete="true"
    				suggestion="#{${dropDownHelper}.searchText}" delay="1"
    				listener="#{${dropDownHelper}.filterItems}"
    				onevent="#{loader.overlayAjaxLoader}">
#end    				<f:selectItems value="#{${dropDownHelper}.foundItems}" 
    					var="${element.value}" itemValue="#{${element.value}}" itemLabel= "#if(!$stringValue.empty)$stringValue#else#{${element.value}}#end">
    				</f:selectItems>
    				<c:pojoConverter></c:pojoConverter>
    			</b:selectOneInput>
    		</b:formGroup>
    		<h:panelGroup rendered="#{${dropDownHelper}.inCreateMode}">
    			<span class="h4">Create ${util.splitCamelCase($element.value)}</span>
    			<ui:include src="${elementModel.name}.crud.xhtml">
    				<ui:param name="obj" value="#{${dropDownHelper}.${util.reverseCamelCase($elementModel.beanClass.simpleName)}}"></ui:param>
    			</ui:include>
    			<b:buttonGroup>
        			<b:button value="Save ${util.splitCamelCase($element.value)}">
						<c:saveUpdate object="#{${dropDownHelper}.${util.reverseCamelCase($elementModel.beanClass.simpleName)}}" action="save" />
        				<f:setPropertyActionListener value="#{${dropDownHelper}.${util.reverseCamelCase($elementModel.beanClass.simpleName)}}" target="#{obj.${element.value}}"></f:setPropertyActionListener>
    					<f:setPropertyActionListener value="#{false}" target="#{${dropDownHelper}.inCreateMode}"></f:setPropertyActionListener>
        				<f:ajax execute="$insetId" render="$insetId" onevent="#{loader.overlayAjaxLoader}"></f:ajax>
        			</b:button>
        			<b:button value="Cancel">
    					<f:ajax onevent="#{loader.overlayAjaxLoader}" execute="@this" render="$insetId"></f:ajax>
    					<f:setPropertyActionListener value="#{false}" target="#{${dropDownHelper}.inCreateMode}"></f:setPropertyActionListener>
        			</b:button>
    			</b:buttonGroup>
    			<br />
    			<br />
    		</h:panelGroup>		
    	</h:panelGroup>	
	</c:unique>
#end#end
#end
</ui:component>
</html>